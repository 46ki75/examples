---
- name: Create
  hosts: localhost
  connection: local
  gather_facts: false
  tasks:
    - name: Deploy the stack
      amazon.aws.cloudformation:
        stack_name: "{{ provisioning_info.cloudformation.stack_name }}"
        template_body: "{{ lookup('ansible.builtin.template', '../../template-molecule.yml') }}"
        capabilities:
          - CAPABILITY_IAM
          - CAPABILITY_NAMED_IAM
        region: "ap-northeast-1"
        state: present
      register: cfn_result

    - name: Print CloudFormation Outputs
      ansible.builtin.debug:
        msg: "{{ cfn_result.stack_outputs }}"
